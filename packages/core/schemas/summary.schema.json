{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://algerknown.dev/schemas/summary.schema.json",
  "title": "Algerknown Summary",
  "description": "A topic summary aggregating learnings, decisions, and artifacts",
  "type": "object",
  "required": ["id", "type", "topic", "status", "summary"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this summary",
      "pattern": "^[a-z0-9-]+$"
    },
    "type": {
      "type": "string",
      "const": "summary"
    },
    "topic": {
      "type": "string",
      "description": "Human-readable topic name"
    },
    "date_range": {
      "$ref": "#/$defs/dateRange"
    },
    "status": {
      "$ref": "#/$defs/status"
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "uniqueItems": true
    },
    "summary": {
      "type": "string",
      "description": "Brief description of the topic"
    },
    "learnings": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/learning"
      }
    },
    "decisions": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/decision"
      }
    },
    "artifacts": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/artifact"
      }
    },
    "open_questions": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "resources": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/resource"
      }
    },
    "links": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/link"
      }
    }
  },
  "$defs": {
    "dateRange": {
      "type": "object",
      "required": ["start"],
      "properties": {
        "start": {
          "type": "string",
          "pattern": "^\\d{4}(-\\d{2})?(-\\d{2})?$",
          "description": "Start date (YYYY, YYYY-MM, or YYYY-MM-DD)"
        },
        "end": {
          "type": "string",
          "pattern": "^\\d{4}(-\\d{2})?(-\\d{2})?$",
          "description": "End date (YYYY, YYYY-MM, or YYYY-MM-DD)"
        }
      }
    },
    "status": {
      "type": "string",
      "enum": ["active", "archived", "reference", "blocked", "planned"],
      "description": "Current status of the topic"
    },
    "learning": {
      "type": "object",
      "required": ["insight"],
      "properties": {
        "insight": {
          "type": "string",
          "description": "The key learning or insight"
        },
        "context": {
          "type": "string",
          "description": "How this was discovered"
        },
        "relevance": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "IDs of related entries"
        }
      }
    },
    "decision": {
      "type": "object",
      "required": ["decision"],
      "properties": {
        "decision": {
          "type": "string",
          "description": "What was decided"
        },
        "rationale": {
          "type": "string",
          "description": "Why this decision was made"
        },
        "trade_offs": {
          "type": "string",
          "description": "What was sacrificed or risked"
        },
        "date": {
          "type": "string",
          "format": "date"
        },
        "superseded_by": {
          "type": "string",
          "description": "ID of decision that replaced this one"
        }
      }
    },
    "artifact": {
      "type": "object",
      "required": ["path"],
      "properties": {
        "repo": {
          "type": "string",
          "description": "Repository URL or name"
        },
        "path": {
          "type": "string",
          "description": "Path within the repo"
        },
        "notes": {
          "type": "string"
        },
        "commit": {
          "type": "string",
          "description": "Specific commit hash"
        }
      }
    },
    "resource": {
      "type": "object",
      "required": ["url"],
      "properties": {
        "url": {
          "type": "string",
          "format": "uri"
        },
        "title": {
          "type": "string"
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "link": {
      "type": "object",
      "required": ["id", "relationship"],
      "properties": {
        "id": {
          "type": "string",
          "description": "ID of the linked entry"
        },
        "relationship": {
          "$ref": "#/$defs/relationship"
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "relationship": {
      "type": "string",
      "enum": [
        "evolved_into",
        "evolved_from",
        "informs",
        "informed_by",
        "part_of",
        "contains",
        "blocked_by",
        "blocks",
        "supersedes",
        "superseded_by",
        "references",
        "referenced_by",
        "depends_on",
        "dependency_of",
        "enables",
        "enabled_by"
      ],
      "description": "How entries relate to each other. Bidirectional pairs allow expressing relationships from either direction."
    }
  }
}
